/** jQuery-USOS 0.9.3 -- https://github.com/MUCI/jquery-usos */ 
(function(d){var v="usosApiTable";function w(z,A){this._state=z;this._lastPublishedState=null;this.onStateChanged=A;this.publishState()}w.prototype.publishState=function(A){var z=this.getState();if((!A)&&(z==this.lastPublishedState)){return}this._lastPublishedState=z;this.onStateChanged(z)};w.prototype.getState=function(){return this._state};w.prototype.setState=function(z){this._state=z;this.publishState()};function x(B,z,C){this.paramName=B;this._lastPublishedState=null;this.onStateChanged=C;var A=this;d(window).bind("hashchange",function(D){A.publishState()});if(this.getState()==null){this.setState(z)}else{this.publishState()}}x.prototype.publishState=function(A){var z=this.getState();if((!A)&&(z==this.lastPublishedState)){return}this._lastPublishedState=z;this.onStateChanged(z)};x.prototype.getState=function(){var z=d.bbq.getState(this.paramName);if(z){return z}return null};x.prototype.setState=function(A){var z={};z[this.paramName]=A;d.bbq.pushState(z)};var l=function(z){return(d.map(z,function(A){return(A.ascending?"":"-")+A.column})).join("|")};var p=function(z){return d.map(z.split("|"),function(A){return{column:A.replace("-",""),ascending:A[0]!="-"}})};var j=function(A){var z;if(A.currentOrder.length>0){z=A.currentOrder[0]}else{z={column:"",ascending:true}}A.elements.$sorters.each(function(){var B=d(this).data(v);if(B.orderRules[0].column==z.column){B.$img.attr("class",z.ascending?"ua-ascending":"ua-descending").show();d(this).closest("td").addClass("ua-sorted-by")}else{B.$img.hide();d(this).closest("td").removeClass("ua-sorted-by")}})};var n=function(A){var z={};d.extend(z,A.settings.params);d.extend(z,{order_by:l(A.currentOrder),start:A.currentOffset,num:A.settings.pageLength});return z};var h=function(E){var A=d("<div>").addClass("ua-container").addClass("ua-table-container");var B=d("<table>").addClass("ua-table").addClass("ua-ellipsis-tds");A.append(B);var D=i(E);B.append(D);var z=d("<tbody>").addClass("ua-contents");B.append(z);var C=a(E);B.append(C);return A};var i=function(A){var z=d("<thead>");var B=d("<tr>");z.append(B);d.each(A.columns,function(C,D){var E=d("<td>");if(D.width){E.css("width",D.width)}if(D.align){E.css("text-align",D.align)}if(D.sortable){E.addClass("ua-sortable");E.append(d("<a>").attr("tabindex",0).addClass("ua-sorter").attr("data-ua-fields",D.field).text(D.label))}else{E.addClass("ua-nonsortable");E.text(D.label)}if(D.cssClass){d.each(D.cssClass.split(" "),function(G,F){if(F){E.addClass(F)}})}B.append(E)});if(A.actions.length>0){B.append(d("<td>").addClass("ua-nonsortable").addClass("ua-actions").css("width",(1+A.actions.length*19)+"px"))}return z};var u=function(z){var A=z.columns.length;if(z.actions.length>0){A++}return A};var s=function(C,B){if(!C.elements.$contents.is(":parent")){C.elements.$contents.html("<tr class='ua-placeholder'><td></td></tr>").find("td").attr("colspan",u(C.settings))}var A=C.elements.$div.find(".ua-overlay-background");if(A.length==0){A=d("<div>").addClass("ua-overlay-background").hide();C.elements.$div.append(A)}var z=C.elements.$div.find(".ua-overlay-foreground");if(z.length==0){z=d("<table>").addClass("ua-overlay-foreground").hide().append(d("<tr>").append(d("<td>")));C.elements.$div.append(z)}z.find("td").empty().append(B.clone());A.css("left",C.elements.$contents.position().left+1).css("top",C.elements.$contents.position().top+1).css("width",C.elements.$contents.width()-1).css("height",C.elements.$contents.height()-1).fadeIn("slow");z.delay(200).each(function(){if(!d.contains(document.documentElement,A[0])){return}z.css(C.elements.$contents.position()).css("width",C.elements.$contents.width()).css("height",C.elements.$contents.height()).fadeIn(500)})};var b=function(z){z.elements.$div.find(".ua-overlay-background").remove();z.elements.$div.find(".ua-overlay-foreground").remove()};var a=function(A){var z=(d("<tfoot>").append(d("<tr>").append(d("<td>").attr("colspan",u(A)).append(d("<table>").append(d("<tr>"))))));z.find("table tr").append(d("<td>").append(d("<div>").addClass("ua-summary"))).append(d("<td>").append(d("<ul>").addClass("ua-more").append(d("<div>").addClass("ua-prevpage").button({disabled:true,icons:{primary:"ui-icon-carat-1-w"},label:d.usosCore.langSelect("POPRZEDNIA STRONA","PREVIOUS PAGE")})).append(d("<div>").addClass("ua-nextpage").button({disabled:true,icons:{secondary:"ui-icon-carat-1-e"},label:d.usosCore.langSelect("NASTĘPNA STRONA","NEXT PAGE")}))));return z};var q=function(A,z){if(typeof z==="string"){z=d("<span>").text(z)}A.elements.$summary.empty().append(z.clone())};var c=function(z){return d("<td>").addClass("ua-datatype-langdict").append(d.usosCore.langSelect({langdict:z,format:"$span"}))};var r=function(z){var A=d("<td>").addClass("ua-datatype-boolean");if(z){A.addClass("ua-true").text(d.usosCore.langSelect("TAK","YES"))}else{A.addClass("ua-false").text(d.usosCore.langSelect("NIE","NO"))}return A};var g="1";var f=function(z){return(g+","+z.offset+","+l(z.orderRules).replace(/\|/g,","))};var m=function(z){try{var A=z.split(",");if(A[0]=="1"){return{offset:parseInt(A[1]),orderRules:p(A.slice(2).join("|"))}}else{throw"Unknown serializer version"}}catch(B){console.error("Could not deserialize state:",B);return{offset:0,orderRules:[]}}};var k=function(z,A){if(!A.field){return d("<td>").text("Missing 'field' key in column spec.")}var C;var B=z;d.each(A.field.split("."),function(D,E){B=B[E]});if(typeof B==="object"){C=c(B)}else{if(typeof B==="number"){C=d("<td>").addClass("ua-datatype-number").text(B)}else{if(typeof B==="string"){C=d("<td>").addClass("ua-datatype-string").text(B)}else{if(typeof B==="boolean"){C=r(B)}else{if(B===null){C=d("<td>").append(d("<span>").addClass("ua-note").text(d.usosCore.langSelect("(brak danych)","(no data)")))}else{if(B===undefined){C=d("<td>").text("Missing field '"+A.field+"' in data feed.")}else{C=d("<td>").text("Unknown column data type.")}}}}}}return C};var t=function(z){return this.each(function(){var C=d(this);if(C.data(v)){C.usosApiTable("destroy")}var E={};C.data(v,E);var B={hashParam:null,sourceId:"default",method:null,params:{},columns:null,defaultOrder:null,pageLength:6};E.settings=B;d.extend(E.settings,z);C.append(h(E.settings));E.elements={$root:C,$div:C.find(".ua-table-container"),$table:C.find(".ua-table"),$summary:C.find(".ua-summary"),$sorters:C.find(".ua-sorter").each(function(){var H=d(this);var G=d("<img>").css("margin-left","3px").hide();H.after(G);var F=d("<span>").addClass("ua-loading").hide();G.after(F);H.data(v,{$img:G,$loader:F,orderRules:p(H.attr("data-ua-fields"))});if(H.parent().hasClass("ua-sortable")){H.parent().click(function(){H.trigger("click")})}}).click(function(){if(!E.initialized){return}var M=d(this).data(v);E.elements.$table.find("thead .ua-loading").hide();M.$loader.show();var L=d.map(M.orderRules,function(P,O){return P.column});E.currentOffset=0;var G=true;if(E.currentOrder.length>0&&E.currentOrder[0].column==L[0]&&E.currentOrder[0].ascending==true){G=false}var N=[];var F=[];for(var I=0;I<E.currentOrder.length;I++){if(d.inArray(E.currentOrder[I].column,L)!=-1){N[E.currentOrder[I].column]=E.currentOrder[I]}else{F.push(E.currentOrder[I])}}var H=[];for(var I=0;I<L.length;I++){var K=null;if(N[L[I]]){K=N[L[I]];K.ascending=G}else{K={column:L[I],ascending:G}}H.push(K)}var J=H;for(var I=0;I<F.length;I++){J.push(F[I])}E.stateCoordinator.setState(f({orderRules:J,offset:0}));return false}).keypress(function(F){if(F.which==13){d(this).click()}}),$contents:C.find(".ua-contents"),$prevPage:C.find(".ua-prevpage").click(function(){d(this).button("disable");E.stateCoordinator.setState(f({offset:E.currentOffset-E.settings.pageLength,orderRules:E.currentOrder}))}),$nextPage:C.find(".ua-nextpage").click(function(){d(this).button("disable");E.stateCoordinator.setState(f({offset:E.currentOffset+E.settings.pageLength,orderRules:E.currentOrder}))})};E.syncObject={};E.defaultAction=null;d.each(E.settings.actions,function(F,G){if(G.isDefault){if(E.defaultAction){console.error("More than one default action defined.");return false}E.defaultAction=G}});E.currentOrder=null;E.currentOffset=0;var A=f({offset:0,orderRules:p(E.settings.defaultOrder)});var D=function(F){E.initialized=true;var G=m(F);E.currentOrder=G.orderRules;E.currentOffset=G.offset;C.usosApiTable("reload")};if(E.settings.hashParam){E.stateCoordinator=new x(E.settings.hashParam,A,D)}else{E.stateCoordinator=new w(A,D)}})};var o=function(){return this.each(function(){var z=d(this);var A=z.data(v);console.log("Reloading with order "+l(A.currentOrder)+"...");j(A);s(A,d("<span>").addClass("ua-loading"));q(A,d("<span>").addClass("ua-loading").text(d.usosCore.langSelect("Wczytywanie...","Loading...")));d.usosCore.usosapiFetch({sourceId:A.settings.sourceId,method:A.settings.method,params:n(A),syncMode:"receiveLast",syncObject:A.syncObject,success:function(B){A.elements.$contents.empty();d.each(B.items,function(E,C){var F=d("<tr>");F.data(v,C);d.each(A.settings.columns,function(H,G){var I;if(G.customTdFormatter){I=G.customTdFormatter(C)}else{I=k(C,G)}if(G.cssClass){d.each(G.cssClass.split(" "),function(K,J){if(J){I.addClass(J)}})}if(G.align){I.css("text-align",G.align)}F.append(I)});if(A.settings.actions.length>0){var D=d("<td>").addClass("ua-actions");d.each(A.settings.actions,function(H,I){var G=d("<a>").attr("tabindex",0).addClass("ua-action-icon").append(d("<div>").addClass("ui-icon").addClass(I.iconClass)).attr("title",I.label).click(function(){I.click(C);return false}).keypress(function(J){if(J.which==13){d(this).click()}});if((I.isVisible)&&(!I.isVisible(C))){G.css("visibility","hidden")}D.append(G)});F.append(D)}A.elements.$contents.append(F)});if(A.defaultAction){A.elements.$contents.find("tr").hover(function(){d(this).addClass("ua-hovered")},function(){d(this).removeClass("ua-hovered")}).click(function(){A.defaultAction.click(d(this).data(v))})}A.elements.$nextPage.button(B.next_page?"enable":"disable");A.elements.$prevPage.button(A.currentOffset>0?"enable":"disable");q(A,d.usosCore.langSelect("Pokazywane elementy ","Showing items ")+(A.currentOffset+1)+".."+(A.currentOffset+B.items.length));A.elements.$table.find("thead .ua-loading").hide();b(A)},error:function(E,D,C){console.error("Error while reloading feed",D,C);var B=d("<span>").html(d.usosCore.langSelect("Wystąpił błąd podczas wczytywania. Spróbuj odświeżyć stronę (F5).","There was an error while loading. Try to refresh the page (F5)."));s(A,B);q(A,B.clone(true));A.elements.$table.find("thead .ua-loading").hide()}})})};var y=function(){return this.each(function(){var A=d(this);var z=A.data(v);z.$root.find("*").andSelf().unbind();A.removeData(v)})};var e={init:t,reload:o,destroy:y};d.fn.usosApiTable=function(z){if(e[z]){return e[z].apply(this,Array.prototype.slice.call(arguments,1))}else{if((typeof z==="object")||(!z)){return t.apply(this,arguments)}else{d.error("Method "+z+" does not exist on jQuery."+v)}}}})(jQuery);(function(f){var c="usosCore";var d={settings:null};var k=function(l){if(d.settings!==null){console.warning("jQuery.usosCore is already initialized! Subsequent calls to init will be ingored!");return}var m={langpref:"en",usosAPIs:{"default":{methodUrl:null,extraParams:{}}}};d.settings=m;f.extend(true,d.settings,l)};var e=function(){if(d.settings===null){throw ("Call jQuery.usosCore.init first!")}};var b=function(o){e();var l={sourceId:"default",method:"method_name",params:{},syncMode:"noSync",syncObject:null,success:null,error:null};var n=l;f.extend(n,o);if(n.syncMode=="noSync"){if(n.syncObject!==null){throw ("syncObject must stay null if syncMode is 'noSync'")}}else{if((n.syncMode=="receiveLast")||(n.syncMode=="receiveIncrementalFast")){if(n.syncObject===null){throw ("syncObject must be an object if syncMode is other than 'noSync'. Check out the docs!")}}else{throw ("Invalid syncMode: "+n.syncMode)}}var p=null;if(n.syncObject!==null){if(typeof n.syncObject.lastIssuedRequestId==="undefined"){n.syncObject.lastIssuedRequestId=0;n.syncObject.lastReceivedRequestId=0}n.syncObject.lastIssuedRequestId++;p=n.syncObject.lastIssuedRequestId}var m=d.settings.usosAPIs[n.sourceId].methodUrl.replace("%s",n.method);var q=n.params;f.extend(q,d.settings.usosAPIs[n.sourceId].extraParams);f.ajax({type:"POST",url:m,data:q,dataType:"json",success:function(s,t,r){if(n.syncObject!==null){if(n.syncObject.lastReceivedRequestId>p){return}if((n.syncMode=="receiveLast")&&p<n.syncObject.lastIssuedRequestId){return}n.syncObject.lastReceivedRequestId=p}if(n.success!==null){n.success(s,t,r)}},error:function(t,s,r){if(n.syncObject!==null){if(n.syncObject.lastReceivedRequestId>p){return}n.syncObject.lastReceivedRequestId=p}if(n.error!==null){n.error(t,s,r)}}})};var g=function(){e();if(arguments.length==2){if(typeof arguments[0]==="object"){return g({langdict:arguments[0],format:arguments[1]})}else{return g({langdict:{pl:arguments[0],en:arguments[1]},format:"text"})}}if(arguments.length!=1){throw ("Invalid arguments",arguments)}var r=arguments[0];if(r.pl&&r.en&&!r.langdict){return g({langdict:r,format:"text"})}var l={langdict:null,format:"text",langpref:"inherit"};var o=l;f.extend(o,r);if(o.langpref=="inherit"){o.langpref=d.settings.langpref}var s=o.langpref;var q=o.langdict.pl;var n=o.langdict.en;if(o.format=="text"){var m;if(s=="pl"){if(q){m=q}else{if(n){m="(po angielsku) "+n}else{m="(brak danych)"}}}else{if(n){m=n}else{if(q){m="(in Polish) "+q}else{m="(unknown)"}}}return m}else{if(o.format=="$span"){var p=f("<span>");if(s=="pl"){if(q){p.html(q)}else{if(n){p.append(f("<span>").addClass("ua-note").text("(po angielsku)")).append(" ").append(f("<span>").html(n))}else{p.append(f("<span>").addClass("ua-note").text("(brak danych)"))}}}else{if(n){p.html(n)}else{if(q){p.append(f("<span>").addClass("ua-note").text("(in Polish)")).append(" ").append(f("<span>").html(q))}else{p.append(f("<span>").addClass("ua-note").text("(unknown)"))}}}return p}}};var a=function(l){if(typeof l==="object"){return f.extend(true,{},l)}else{return l}};var h=function(l){var n=[];for(var m=0;m<l.length;m++){n.push(a(l[m]))}return n};var i={log:function(){console.log.apply(console,h(arguments))},warn:function(){console.warn.apply(console,h(arguments))},error:function(){console.error.apply(console,h(arguments))}};var j=function(){e();return d.settings.langpref};f.usosCore={init:k,usosapiFetch:b,getLangPref:j,langSelect:g,console:i}})(jQuery);(function(d){var i="usosOverlays.contextMessage";var h="usosOverlays.progress";var e=false;var g=function(l){var n=d(window).scrollTop();var m=n+d(window).height();var j=d(l).offset().top;var k=j+d(l).height();return((k<=m)&&(j>=n))};var f=function(j){return this.each(function(){var k=d(this);if(k.data(i)){k.usosOverlays("hideContextMessage",function(){k.usosOverlays("showContextMessage",j)});return}var l={};l.settings={type:null,message:null,scrollToBeVisible:true};d.extend(l.settings,j);if(l.settings.type!=="error"){d.usosCore.console.error("Message type must equal 'error'.");return}if(l.settings.message===null){d.usosCore.console.error("Message parameter is missing.");return}k.data(i,l);l.$error=d("<div>").addClass("ua-container").addClass("ua-form-error").css("opacity",".1").text(l.settings.message);d("body").append(l.$error);l.$error.position({my:"center-20 bottom-3",at:"right top",of:k,using:function(m,n){d(this).css(m);d("<div>").addClass("ua-form-error-arrow").addClass(n.vertical).addClass(n.horizontal).appendTo(this)}});l.$error.click(function(){var m=k.find("input:visible, select:visible, textarea:visible");if(m.length==0){k.trigger("focus")}else{if(m.length==1){m.trigger("focus")}else{k.usosOverlays("hideContextMessage")}}});k.find("input:visible, select:visible, textarea:visible").andSelf().on("focus."+i+" keypress."+i+" change."+i,function(){k.usosOverlays("hideContextMessage")});l.$error.fadeTo("fast",1);if(l.settings.scrollToBeVisible&&(!g(l.$error))&&(!e)){e=true;d("html, body").animate({scrollTop:l.$error.offset().top-30},500,function(){e=false})}})};var a=function(j){return this.each(function(){var k=d(this);var l=k.data(i);if(!l){return}l.$error.unbind();k.unbind("."+i);k.removeData(i);l.$error.fadeTo("fast",0,function(){l.$error.remove();if(j){j()}})})};var c=function(j){return this.each(function(){var m=d(this);var o=m.data(h);if(!o){o={};m.data(h,o);o.settings={state:"loading",delay:300,opacity:0.8,fadeDuration:300}}if(typeof j!=="object"){j={state:j}}d.extend(o.settings,j);if(o.settings.state=="hide"){if(o){o.$bg.remove();o.$fg.remove();m.removeData(h)}return}if(!o.$bg){o.$bg=d("<div>").addClass("ua-progressoverlay-background").hide();d(document.body).append(o.$bg);o.$fg=d("<table>").addClass("ua-progressoverlay-foreground").hide().append(d("<tr>").append(d("<td>")));d(document.body).append(o.$fg)}var l=o.$bg;var k=o.$fg;k.find("td").empty();l.add(k).css("left",m.position().left).css("top",m.position().top).css("width",m.outerWidth()).css("height",m.outerHeight()).css("opacity",o.settings.opactity).delay(o.settings.delay).fadeIn(o.settings.fadeDuration);var n;switch(o.settings.state){case"loading":n=d.usosCore.langSelect("Wczytywanie...","Loading...");break;case"saving":n=d.usosCore.langSelect("Zapisywanie...","Saving...");break;case"hide":throw ("Should return eariler!");default:throw ("Unknown state: "+o.settings.state)}k.find("td").append(d("<span>").attr("class","ua-loading").attr("title",n));k.delay(o.settings.delay+(o.settings.fadeDuration/2)).each(function(){if(!d.contains(document.documentElement,l[0])){return}k.fadeIn(o.settings.fadeDuration)})})};var b={showContextMessage:f,hideContextMessage:a,progressIndicator:c};d.fn.usosOverlays=function(j){if(b[j]){return b[j].apply(this,Array.prototype.slice.call(arguments,1))}else{d.error("Method "+j+" does not exist on jQuery."+NS)}}})(jQuery);(function(d){var n="usosSelector";var a=null;var e=function(s,t){g();a=setTimeout(function(){a=null;t()},s*1000)};var g=function(){if(a){clearTimeout(a);a=null}};var o=function(){return 0};var j=function(s){s.$root.addClass("ua-filled")};var c=function(s){s.$root.removeClass("ua-filled")};var p=function(){var u=d(this);var v=u.data(n);v.knownItems={};u.empty().addClass("ua-container ua-selector").css("width",v.settings.width).append(d("<textarea>").attr("rows","1").css("width",v.settings.width));v.suggestionsSyncObject={};v.previousValue=v.settings.multi?[]:null;v.$root=u;v.$textarea=u.find("textarea");var s=v.$root.offset().top;var t=d(document).height()-v.$root.offset().top-v.$root.height();v.$textarea.textext({plugins:"autocomplete tags focus prompt",prompt:v.settings.prompt,autocomplete:{dropdown:{maxHeight:"200px",position:(t>200)?"below":((s>t)?"above":"below")},render:function(w){return d("<span>").addClass("text-label").html(v.settings.suggestionRenderer(v.knownItems[w]))}},ext:{tags:{renderTag:function(w){var x=d(this.opts("html.tag"));x.find(".text-label").html(v.settings.tagRenderer(v.knownItems[w]));x.data(n,v.knownItems[w]);x.data("text-tag",w);return x}}}}).bind("getSuggestions",function(z,y){var A=d(this);var w=d(z.target).textext()[0];var x=(y?y.query:"")||"";e(o(),function(){d.usosCore.usosapiFetch({sourceId:v.settings.sourceId,method:v.settings.search.method,params:v.settings.search.paramsProvider(x),syncMode:"receiveIncrementalFast",syncObject:v.suggestionsSyncObject,success:function(C){var B=[];d.each(v.settings.search.itemsExtractor(C),function(D,E){var F=v.settings.idExtractor(E);v.knownItems[F]=E;B.push(F)});A.trigger("setSuggestions",{result:B})},error:function(D,C,B){console.error("Error while loading suggestions",C,B);v.$textarea.usosOverlays("showContextMessage",{type:"error",message:d.usosCore.langSelect("Nie udało się wczytać listy sugestii. Spróbuj odświeżyć stronę (F5).","Could not load the list of suggesstions. Try to refresh tha page (F5).")})}})})}).bind("isTagAllowed",function(y,x){if(!v.knownItems[x.tag]){v.$textarea.usosOverlays("showContextMessage",{type:"error",message:d.usosCore.langSelect("Przed wciśnięciem Enter należy poczekać na załadowanie listy sugestii.","Before pressing Enter, you should wait until the suggestions show up.")});x.result=false;return}var w=k(v);if((!v.settings.multi)&&(w.length>0)){b(v,[]);return}if(v.settings.multi&&d.inArray(x.tag,w)>=0){v.$textarea.usosOverlays("showContextMessage",{type:"error",message:d.usosCore.langSelect("Ta pozycja już znajduje się na liście.","This item is already on the list.")});x.result=false;return}}).bind("setFormData",function(){var w=v.$root.usosSelector("value");if(!v.settings.multi){if(w===null){c(v)}else{j(v)}}if(w!=v.previousValue){v.previousValue=w;v.$root.change()}});if(v.settings.value){v.$root.usosSelector("value",v.settings.value)}};var f=function(s){return{prompt:d.usosCore.langSelect("Wpisz imię i nazwisko","Enter a name"),search:{method:"services/users/search",paramsProvider:function(t){return{name:t}},itemsExtractor:function(t){return t.items}},get:{method:"services/users/users",paramsProvider:function(t){return{user_ids:t.join("|"),fields:"id|first_name|last_name"}},itemsExtractor:function(u){var t=[];d.each(u,function(v,w){if(w===null){console.error("User "+v+" not found! Will be skipped!");return true}t.push(w)});return t}},idExtractor:function(t){return t.user_id||t.id},suggestionRenderer:function(t){return t.match},tagRenderer:function(t){if(t.match){return d("<span>").html(t.match).text()}else{return t.first_name+" "+t.last_name}}}};var i=function(s){return{prompt:d.usosCore.langSelect("Wpisz nazwę przedmiotu","Enter a course name"),search:{method:"services/courses/search",paramsProvider:function(t){return{lang:d.usosCore.getLangPref(),name:t}},itemsExtractor:function(t){return t.items}},get:{method:"services/courses/courses",paramsProvider:function(t){return{course_ids:t.join("|"),fields:"id|name"}},itemsExtractor:function(u){var t=[];d.each(u,function(w,v){if(v===null){console.error("Course "+w+" not found! Will be skipped!");return true}t.push(v)});return t}},idExtractor:function(t){return t.course_id||t.id},suggestionRenderer:function(t){return t.match},tagRenderer:function(v){var t;if(v.match){t=d("<span>").html(v.match).text();var u=t.indexOf(" ("+v.course_id+")");if(u>0){t=t.substring(0,u)}}else{t=d.usosCore.langSelect(v.name)}return d("<span>").text(t).css({"white-space":"nowrap",display:"inline-block",overflow:"hidden","max-width":"180px","text-overflow":"ellipsis"})}}};var l=function(s){return{prompt:d.usosCore.langSelect("Wpisz nazwę jednostki","Enter a faculty name"),search:{method:"services/fac/search",paramsProvider:function(t){return{lang:d.usosCore.getLangPref(),fields:"id|match|name",query:t}},itemsExtractor:function(t){return t.items}},get:{method:"services/fac/faculties",paramsProvider:function(t){return{fac_ids:t.join("|"),fields:"id|name"}},itemsExtractor:function(u){var t=[];d.each(u,function(v,w){if(w===null){console.error("Faculty "+v+" not found! Will be skipped!");return true}t.push(w)});return t}},idExtractor:function(t){return t.fac_id||t.id},suggestionRenderer:function(t){return t.match},tagRenderer:function(u){var t=d.usosCore.langSelect(u.name);return d("<span>").text(t).css({"white-space":"nowrap",display:"inline-block",overflow:"hidden","max-width":"250px","text-overflow":"ellipsis"})}}};var m=function(s){return this.each(function(){var t=d(this);if(t.data(n)){t.usosSelector("destroy")}var u={};t.data(n,u);u.settings={entity:null,sourceId:"default",width:"300px",multi:false,value:null};d.extend(u.settings,s);if(u.settings.entity=="user"){d.extend(u.settings,f(u.settings))}else{if(u.settings.entity=="course"){d.extend(u.settings,i(u.settings))}else{if(u.settings.entity=="faculty"){d.extend(u.settings,l(u.settings))}else{throw ("Unknown entity: "+u.settings.entity)}}}p.apply(this)})};var k=function(t){var s=[];d.each(t.$textarea.textext()[0].tags().tagElements(),function(u,v){s.push(t.settings.idExtractor(d(v).data(n)))});return s};var b=function(w,t){var v=w.$textarea.prop("disabled");w.$textarea.prop("disabled",true);var s=function(){d.each(k(w),function(y,z){w.$textarea.textext()[0].tags().removeTag(z)});var x=t.filter(function(y){return typeof w.knownItems[y]!=="undefined"});w.$textarea.textext()[0].tags().addTags(x);w.$textarea.prop("disabled",v);if(x.length<t.length){w.$textarea.usosOverlays("showContextMessage",{type:"error",message:d.usosCore.langSelect("Wystąpił błąd podczas wczytywania wartości tego pola. Sprawdź, czy pole zawiera porządaną wartość. Jeśli problem będzie się powtarzał, prosimy skontaktować się z administratorem.","Error occured while loading values for this form field. Check if the field has the proper value. If this problem persists, please contact the administrator.")})}};var u=t.filter(function(x){return typeof w.knownItems[x]==="undefined"});if(u.length>0){d.usosCore.usosapiFetch({sourceId:w.settings.sourceId,method:w.settings.get.method,params:w.settings.get.paramsProvider(u),success:function(x){d.each(w.settings.get.itemsExtractor(x),function(y,z){var A=w.settings.idExtractor(z);w.knownItems[A]=z});s()},error:function(z,y,x){w.$textarea.usosOverlays("showContextMessage",{type:"error",message:d.usosCore.langSelect("Wystąpił błąd podczas wczytywania wartości tego pola. Spróbuj odświeżyć stronę (F5).","Error occured while loading values for this form field. Try to refresh the page (F5).")})}})}else{s()}};var q=function(t){var s=(typeof t==="undefined")?null:this;this.each(function(){var v=d(this);var w=v.data(n);if(typeof t==="undefined"){var u=k(w);if(w.settings.multi){s=u}else{if(u.length==0){s=null}else{s=u[0]}}return false}if(w.settings.multi){b(w,t)}else{if(t===null){b(w,[])}else{b(w,[t])}}});return s};var r=function(){return this.each(function(){var s=d(this);var t=s.data(n);t.$root.find("*").andSelf().unbind();t.$root.remove();s.removeData(n)})};var h={init:m,value:q,destroy:r};d.fn.usosSelector=function(s){if(h[s]){return h[s].apply(this,Array.prototype.slice.call(arguments,1))}else{if((typeof s==="object")||(!s)){return m.apply(this,arguments)}else{d.error("Method "+s+" does not exist on jQuery."+n)}}}})(jQuery);